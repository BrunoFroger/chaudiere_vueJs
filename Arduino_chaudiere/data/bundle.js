(()=>{"use strict";const e={props:[],data:function(){return{}},mounted(){},template:"        <div>          <h1>Pages de gestion de la chaudiere</h1>          <p>Ce site permet de gerer la chaudiere, voici une description des differentes pages accessible depuis le bandeau supérieur:</p>          <ul>            <li>home : page de présentation ; affichée lors de l'ouverture de ce site</li>            <li>calendrier : permet de fixer les périodes de mise en route de la chaudière,               vous disposez de 5 plages par jour sur 1 semaine,               pour chacune de ces plages, vous pouvez fixer les parametres suivants :</li>              <ul>                <li>heure de debut</li>                <li>heure de fin</li>                <li>consigne de chauffage</li>                <li>chauffage on/off</li>              </ul>            <li>temperature : permet de visualiser les differentes temperatures mesurées</li>              <ul>                <li>temperature intérieure</li>                <li>temperature extérieure</li>                <li>consigne de chauffage</li>              </ul>            <li>configuration : permet de visualiser/modifier les parametres de configuration</li>          </ul>        </div>      ",methods:{}},t={props:[],data:function(){return{consigne:null,chauffageMode:"OFF",chauffageStatus:null,circulateurOnOff:null,commandeVanneChauffage:null,temperatureInterieure:null,temperatureExterieure:null,afficheurOnOff:null}},mounted(){this.loadDatasCommande()},template:'      <div>        <h1>Commandes de chauffage</h1>      </div>      <div>        <table>          <thead>              <tr>                  <th> variable </th>                  <th> valeur </th>                  <th> commentaire </th>              </tr>          </thead>          <tbody>            <tr>              <td> chauffage </td>              <td align="center">                <form>                  <select name="modeChauffage" v-model="chauffageMode" @change="switchChauffageMode()">                    <option value="OFF">OFF</option>                    <option value="PROG">PROG</option>                    <option value="FORCE">FORCE</option>                    <option value="AUTO">AUTO</option>                  </select>                </form>              </td>              <td> activation du chauffage :                 <br> OFF : chauffage eteint                <br> PROG : le calendrier (et la temperature) definissent la mise en route du circulateur                <br> FORCE : le chauffage est allumé sans régulation                <br> AUTO : la temperature regule le chauffage              </td>            </tr>            <tr>              <td> plage calendrier </td>              <td align="center">{{chauffageStatus}}</td>              <td> ON si dans une plage active dans le calendrier</td>            </tr>            <tr>              <td> circulateur </td>              <td align="center"> {{circulateurOnOff}} </td>              <td> circulateur en route si chauffage ON et dans une plage calendrier ON </td>            </tr>            <tr>              <td> vanne chauffage </td>              <td align="center">{{commandeVanneChauffage}}</td>              <td> valeur de la commande appliquee a la vanne de chauffage </td>            </tr>            <tr>              <td> Consigne </td>              <td align="center">{{this.$parent.formatTemperature(consigne)}}</td>              <td> Consigne de temperature </td>            </tr>            <tr>              <td> temperature interieure </td>              <td align="center">{{this.$parent.formatTemperature(temperatureInterieure)}}</td>              <td> Valeur mesuree de temperature interieure </td>            </tr>            <tr>              <td> temperature exterieure </td>              <td align="center">{{this.$parent.formatTemperature(temperatureExterieure)}}</td>              <td> Valeur mesuree de temperature iexterieure </td>            </tr>            <tr>              <td> afficheur </td>              <td align="center" @click="switchAfficheurOnOff">{{afficheurOnOff}}</td>              <td> active ou non l\'afficheur de l\'arduino </td>            </tr>          </tbody>        </table>        <button @click="loadDatasCommande">refresh</button>      </div>    ',methods:{switchChauffageMode(){let e=this.$parent.httpServer+"/switchChauffageMode?chauffageMode="+this.chauffageMode;fetch(e).then((e=>{this.loadDatasCommande()}))},switchModeRegulation(){let e=this.$parent.httpServer+"/switchModeRegulation";fetch(e).then((e=>{this.loadDatasCommande()}))},switchAfficheurOnOff(){let e=this.$parent.httpServer+"/switchAfficheurOnOff";fetch(e).then((e=>{this.loadDatasCommande()}))},loadDatasCommande(){let e=this.$parent.httpServer+"/getDatasCommande";fetch(e).then((e=>e.json())).then((e=>{this.consigne=e.consigne,this.chauffageMode=e.chauffageMode,this.chauffageStatus=e.chauffageStatus,this.circulateurOnOff=e.circulateurOnOff,this.commandeVanneChauffage=e.commandeVanneChauffage,this.temperatureInterieure=e.temperatureInterieure,this.temperatureExterieure=e.temperatureExterieure,this.afficheurOnOff=e.afficheurOnOff})).catch((e=>{console.error(e),this.consigne=null}))}}},a={props:[],data:function(){return{calendar:{},nbPlage:4,edit:{},days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]}},mounted(){this.load()},template:'        <div>        <h1>Calendrier de chauffage</h1>        <button @click="load">refresh</button>        <table>          <thead>            <tr>              <th></th>              <th colspan="5" v-for="plage in nbPlage">plage {{plage-1}}</th>            </tr>            <tr>              <th></th>              <template v-for="plage in nbPlage">                <th>début</th>                <th>fin</th>                <th>consigne</th>                <th>actif?</th>                <th>action</th>              </template>            </tr>          </thead>          <tbody>            <tr v-for="day, idx in days">              <td>{{day}}</td>              <template v-for="plage in nbPlage">                <template v-if="edit[`${idx}-${plage-1}`]">                  <td><input type="number" size="4" v-model.number="edit[`${idx}-${plage-1}`].heureDebut"/>:<input type="number" size="4" v-model.number="edit[`${idx}-${plage-1}`].minuteDebut"/></td>                  <td><input type="number" size="4" v-model.number="edit[`${idx}-${plage-1}`].heureFin"/>:<input type="number" size="4" v-model.number="edit[`${idx}-${plage-1}`].minuteFin"/></td>                  <td><input type="number" size="6" v-model.number="edit[`${idx}-${plage-1}`].consigne"/></td>                  <td><input type="checkbox" v-model.boolean="edit[`${idx}-${plage-1}`].chauffageOnOff"/></td>                  <td>                    <a href="#" @click.prevent="cancelEdit(idx, plage-1)">cancel</a>                    <a href="#" @click.prevent="saveEdit(idx, plage-1)">save</a>                  </td>                </template>                <template v-else-if="calendar && calendar[`jour${idx}`] && calendar[`jour${idx}`][`plage${plage-1}`] && calendar[`jour${idx}`][`plage${plage-1}`] && calendar[`jour${idx}`][`plage${plage-1}`].plageActive">                  <td>{{formatDate(calendar[`jour${idx}`][`plage${plage-1}`].heureDebut, calendar[`jour${idx}`][`plage${plage-1}`].minuteDebut)}}</td>                  <td>{{formatDate(calendar[`jour${idx}`][`plage${plage-1}`].heureFin, calendar[`jour${idx}`][`plage${plage-1}`].minuteFin)}}</td>                  <td>{{formatConsigne(calendar[`jour${idx}`][`plage${plage-1}`].consigne)}}</td>                  <td>{{calendar[`jour${idx}`][`plage${plage-1}`].chauffageOnOff ? "oui" : "non"}}</td>                  <td>                    <a href="#" @click.prevent="disablePlage(idx, plage-1)">disable</a>                    <a href="#" @click.prevent="editPlage(idx, plage-1)">edit</a>                    </td>                </template>                <template v-else>                  <td colspan="4">inactive</td>                  <td><a href="#" @click.prevent="editPlage(idx, plage-1)">edit</a></td>                </template>              </template>            </tr>          </tbody>        </table>        </div>      ',methods:{load(){let e=this.$parent.httpServer+"/loadCalendrier";fetch(e).then((e=>e.json())).then((e=>{this.calendar=e}))},save(){let e=this.$parent.httpServer+"/saveCalendrier";fetch(e,{headers:{},method:"POST",body:JSON.stringify(this.calendar)}).then((e=>e.json())).then((e=>{this.calendar=e}))},formatDate:(e,t)=>`${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}`,editPlage(e,t){console.log("editPlage "+e+"/"+t),this.calendar&&this.calendar[`jour${e}`]&&this.calendar[`jour${e}`][`plage${t}`]&&this.calendar[`jour${e}`][`plage${t}`].plageActive?this.edit[`${e}-${t}`]=this.calendar[`jour${e}`][`plage${t}`]:this.edit[`${e}-${t}`]={modele:0,heureDebut:0,minuteDebut:0,heureFin:23,minuteFin:59,chauffageOnOff:!1,consigne:200,plageActive:!0}},disablePlage(e,t){console.log("disablePlage "+e+"/"+t);let a=!0;this.calendar&&this.calendar[`jour${e}`]&&this.calendar[`jour${e}`][`plage${t}`]&&this.calendar[`jour${e}`][`plage${t}`].plageActive&&(!1,delete this.edit[`${e}-${t}`]),console.log("disablePlage "+e+"/"+t),delete this.calendar[`jour${e}`][`plage${t}`],this.save(),this.load()},cancelEdit(e,t){console.log("cancelEdit "+e+"/"+t),delete this.edit[`${e}-${t}`],this.save()},saveEdit(e,t){console.log("saveEdit "+e+"/"+t),this.calendar[`jour${e}`][`plage${t}`]=this.edit[`${e}-${t}`],delete this.edit[`${e}-${t}`],this.save()},formatConsigne:e=>`${e/10}.${e%10} °C`}},r={props:[],data:function(){return{temperatureInterieure:null,temperatureExterieure:null,ipTempInt:null,ipTempExt:null,consigne:null}},mounted(){this.loadDatasTemperatures()},template:"      <div>        <h1>Temperatures</h1>      </div>      <div>        <form>          <table>            <thead>              <tr>                <th>variable</th>                <th>valeur</th>              </tr>            </thead>            <tbody>              <tr>                <td>Temperature interieure</td>                <td>{{this.$parent.formatTemperature(temperatureInterieure)}}</td>              </tr>              <tr>                <td>Temperature exterieure</td>                <td>{{this.$parent.formatTemperature(temperatureExterieure)}}</td>              </tr>              <tr>                  <td>Consigne</td>                  <td>{{this.$parent.formatTemperature(consigne)}}</td>              </tr>              <tr>                <td>Adresse IP capteur temp int</td>                <td>{{ipTempInt}}</td>              </tr>              <tr>                <td>Adresse IP capteur temp ext</td>                <td>{{ipTempExt}}</td>              </tr>            </tbody>          </table>        </form>        <button @click='loadDatasTemperatures'>refresh</button>      </div>      ",methods:{updateIpTempInt(){let e=this.$parent.httpServer+"/updateIpTempInt?ip="+this.ipTempInt;fetch(e).then((e=>{this.loadDatasTemperatures()}))},updateConsigne(){let e=this.$parent.httpServer+"/updateConsigne?consigne="+this.consigne;fetch(e).then((e=>{this.loadDatasTemperatures()}))},updateIpTempExt(){let e=this.$parent.httpServer+"/updateIpTempExt?ip="+this.ipTempExt;fetch(e).then((e=>{this.loadDatasTemperatures()}))},loadDatasTemperatures(){let e=this.$parent.httpServer+"/getDatasTemperatures";fetch(e).then((e=>e.json())).then((e=>{this.consigne=e.consigne,this.temperatureInterieure=e.temperatureInterieure,this.temperatureExterieure=e.temperatureExterieure,this.ipTempInt=e.adresseIpTempInt,this.ipTempExt=e.adresseIpTempExt,""==this.ipTempInt&&(this.ipTempInt="non connecté"),""==this.ipTempExt&&(this.ipTempExt="non connecté")})).catch((e=>{console.error(e),this.consigne=null}))}}},i={props:[],data:function(){return{environnements:{},configuration:{},ipTempInt:null,ipTempExt:null,consigne:null}},mounted(){this.loadEnvironnements(),this.loadDatasConfig()},template:'      <div>        <h1>Configuration</h1>        <p>Cette page affiche les parametres contenus dans la carte SD</p>        <p>Pour modifier l\'environnement a utiliser ; il faut éditer le fichier de configuration sur la carte SD</p>      </div>      <div>        <table>          <thead>            <tr>              <th>variable</th>              <th>valeur</th>            </tr>          </thead>          <tbody>              <tr>                <td>Consigne de chauffage (en 1/10° de degré : 200=20.0°C)</td>                <td>                  {{this.$parent.formatTemperature(configuration.consigne)}}<br>                  <input id="consigne" name="consigne" v-model="configuration.consigne" @keyup.enter="updateConsigne()"/>                </td>              </tr>              <tr>                  <td>Environnement utilise</td>                  <td>{{configuration.envSelectionne}}</td>              </tr>              <tr>                  <td>Pin relai</td>                  <td>{{configuration.pinRelai}}</td>              </tr>              <tr>                  <td>Regulation</td>                  <td>{{configuration.regulation}}</td>              </tr>              <tr>                  <td>Heure été/hiver</td>                  <td>{{configuration.heureEteHivers ? "été" : "hiver"}}</td>              </tr>              <tr>                  <td>chauffage</td>                  <td>{{configuration.chauffageOnOff ? "ON" : "OFF"}}</td>              </tr>              <tr>                  <td>Adresse IP du capteur de température intérieure</td>                  <td>                    <input id="ipTempInt" name="ipTempInt" v-model="ipTempInt" @keyup.enter="this.configurationUpdateIpTempInt()"/>                  </td>              </tr>              <tr>                  <td>Adresse IP du capteur de température extérieure</td>                  <td>                    <input id="ipTempExt" name="ipTempExt" v-model="ipTempExt" @keyup.enter="this.configurationUpdateIpTempExt()"/>                  </td>              </tr>              <tr>                  <td>Référence consigne jour</td>                  <td>{{this.$parent.formatTemperature(configuration.consigneJour)}}</td>              </tr>              <tr>                  <td>Référence consigne nuit</td>                  <td>{{this.$parent.formatTemperature(configuration.consigneNuit)}}</td>              </tr>              <tr>                  <td>Référence consigne absent</td>                  <td>{{this.$parent.formatTemperature(configuration.consigneAbsent)}}</td>              </tr>          </tbody>        </table>      </div>      <p>liste des environnements definis</p>      <div>        <table>          <thead>            <tr>              <th>id</th>              <th>nom</th>              <th>Wifi SSID</th>              <th>Wifi pwd</th>            </tr>          </thead>          <tbody>            <tr v-for="environnement, idx in environnements">              <td>{{idx}}</td>              <td>{{environnements[idx].nom}}</td>              <td>{{environnements[idx].ssid}}</td>              <td>{{environnements[idx].pwd}}</td>            </tr>          </tbody>        </table>      </div>      <div>        <p><a href="/listFichierConfig">  afficher fichier de configuration </a></p>      </div>    ',methods:{loadEnvironnements(){let e=this.$parent.httpServer+"/environnements.json";fetch(e).then((e=>e.json())).then((e=>{this.environnements=e}))},updateConsigne(){let e=this.$parent.httpServer+"/updateConsigne?consigne="+this.configuration.consigne;fetch(e).then((e=>{this.loadDatasConfig()}))},configurationUpdateIpTempInt(){console.log("updateIpTempInt => "+this.ipTempInt);let e=this.$parent.httpServer+"/updateIpTempInt?ip="+this.ipTempInt;fetch(e).then((e=>{this.loadDatasConfig()}))},configurationUpdateIpTempExt(){console.log("updateIpTempExt => "+this.ipTempExt);let e=this.$parent.httpServer+"/updateIpTempExt?ip="+this.ipTempExt;fetch(e).then((e=>{this.loadDatasConfig()}))},loadDatasConfig(){let e=this.$parent.httpServer+"/getDatasConfig";fetch(e).then((e=>e.json())).then((e=>{this.configuration=e,this.ipTempInt=e.adresseIpTempInt,this.ipTempExt=e.adresseIpTempExt})).catch((e=>{console.error(e),this.configuration.consigne=null}))}}},{createApp:n}=Vue,d=n({data:()=>({currentDateTime:"",page:"home",board:null,copyright:null,httpServer:"http://localhost:3000"}),mounted(){this.loadDatasPiedPage(),this.updateDateTime(),setInterval(this.updateDateTime,1e3)},template:'        <div class="entete">          <table>            <tr>              <td><a href="#" @click.prevent="page=\'home\'">home</a></td>              <td><a href="#" @click.prevent="page=\'commande\'">commande</a></td>              <td><a href="#" @click.prevent="page=\'calendrier\'">calendrier</a></td>              <td><a href="#" @click.prevent="page=\'temperature\'">temperature</a></td>              <td><a href="#" @click.prevent="page=\'configuration\'">configuration</a></td>              \x3c!--td><a href="#" @click.prevent="page=\'calendrier2\'">calendrier2</a></td--\x3e              <td>{{currentDateTime}}</td>            </tr>          </table>        </div>        <div>          <component v-bind:is="page"></component>        </div>        <div class="piedPage">          <p>Ce serveur est hébergé sur un arduino : {{board}}</p>          <i>Créé par : {{copyright}}</i>        </div>      ',methods:{updateDateTime(){const e=new Date;this.currentDateTime=e.toLocaleString()},loadDatasPiedPage(){let e=this.httpServer+"/getDatasPiedPage";fetch(e).then((e=>e.json())).then((e=>{this.board=e.board,this.copyright=e.copyright})).catch((e=>{console.error(e)}))},formatTemperature:e=>`${Math.trunc(e/10)}.${e%10} °C`}});d.component("home",e),d.component("commande",t),d.component("calendrier",a),d.component("temperature",r),d.component("configuration",i),d.mount("#app")})();